# Справочник (Directory Service)

## Описание проекта

REST API приложения для поиска организация по различным критериям (названию, зданию, виду деятельности и географическому положению). API предоставляет read-only функционал.

Приложение доступно по адресу [http://localhost/](http://localhost/)


## Сущности
### Организация

Организация представляет собой карточку в справочнике и содержит:
* Название (ООО "Рога и Копыта")
* Список Телефонов (2-222-222, 3-333-333, 8-923-666-13-13)
* Здание
* Список видов Деятельности

### Здание

Содержит информацию о конкретном здании:
* Адрес(г. Москва, ул. Ленина, д. 1, офис 3)
* Географические координаты:
  * широта (latitude)
  * долгота (longitude)

### Вид деятельности

Позволяет классифицировать организации по роду деятельности и содержит:
* Название (Молочная продукция)
* Идентификатор Деятельности-родителя (если имеется)
* Список вложенных Деятельностей

Поддерживает древовидную структуру вложенности (до 3 уровней).  
Пример дерева деятельностей:
```text
Еда  
 ├── Молочная продукция  
 │   └── Сыры  
 └── Мясная продукция

Мебель  
 ├── Кровать  
 ├── Диван  
 ├── Стул  
 └── Стол  
```

### Телефон

Вынесено в отдельную сущность для возможности дальнейшего масштабирования. Содержит:
* Номер телефона (TODO: настроить валидацию)

### Реализованные эндпоинты

| Метод | Путь                                                                                            | Описание                                                      |
|-------|-------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
| GET   | `/api/organizations/{organization_id:int}`                                                      | Получить информацию об организации                            |
| GET   | `/api/organizations/building/{building_id}`                                                     | Обновление информации о грибе по его идентификатору           |
| GET   | `/api/organizations/category/{category_id}`                                                     | Получить список организаций с деятельностью                   |
| GET   | `/api/organizations/nested-categories/{category_id}`                                            | Получить список организаций с деятельностью и её наследниками |
| GET   | `/api/organizations/geo/radius?latitude={latitude}&longitude={longitude}&radius_km={radius_km}` | Получить список организаций в радиусе                         |
| GET   | `/api/organizations/search?name={name}`                                                         | Поиск организации по названию                                 |
| GET   | `/api/buildings/geo/radius?latitude={latitude}&longitude={longitude}&radius_km={radius_km}`     | Получить список зданий в радиусе                              |

Взаимодействие с API происходит через статический API-ключ. Ключ передаётся в HTTP-заголовке:  
`Authorization: Bearer <API_KEY>`

Все ответы возвращаются в формате JSON.


### Автор проекта Артём Куликов

tg: [@Berg1005](https://t.me/berg1005)

[GitHub](https://github.com/berg96)

## Используемые технологии 

Для хранения данных в проекте используется реляционная база данных PostgreSQL с расширением PostGIS для более легкого вычисления расстояния между точками. Проект реализован на языке python c использованием следующего технологического стека:

* FastAPI
* sqlalchemy
* Pydantic
* Alembic
* pytest
* GeoAlchemy2

## Как запустить проект

Клонировать репозиторий:
```
git clone https://github.com/berg96/directory_testtask_secunda
```
Перейти в него в командной строке:
```
cd directory_testtask_secunda
```
Создать файл .env с актуальными переменными окружения по примеру .env_example

Запустить Docker compose:
```
docker compose up -d
```
Документация API при запущенном контейнере доступна по следующему адресу:
[http://localhost/docs](http://localhost/docs)
